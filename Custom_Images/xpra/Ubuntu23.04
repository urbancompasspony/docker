FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt update && \
    apt install -y xpra wget curl grep sed dpkg \
    xvfb \
    xterm \
    sshfs && \
    apt clean && \ 
    rm -rf /var/lib/apt/lists/*
   
# Add sudo to user
#RUN adduser --disabled-password --gecos "user" --uid 1000 user
#RUN apt update && apt install -y sudo
#RUN usermod -aG sudo user
#RUN echo 'ALL ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

#RUN apt update && apt install -y sudo
#RUN usermod -aG sudo user
#RUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

RUN apt update && \
    DEBIAN_FRONTEND=noninteractive && \
    apt clean && \ 
    rm -rf /var/lib/apt/lists/*

RUN apt update && apt install -y apt-utils \
    build-essential \
    firefox \
    gdm3 \
    glances \
    glmark2 \
    mate-session \
    mate-terminal \
    htop \
	btop \
    libqt5x11extras5 \
    software-properties-common \
    tasksel

RUN mkdir -p /run/user/1000/xpra
RUN mkdir -p /run/xpra

RUN chown user:user /run/user/1000/xpra
RUN chown user:user /run/xpra
RUN echo "LANG=pt_BR.UTF-8" >> /etc/locale.conf

RUN apt install -y language-pack-en-base && \ 
    locale-gen pt_BR.UTF-8 && \ 
    update-locale LANG=pt_BR.UTF-8

RUN echo LANG="pt_BR.UTF-8" > /etc/default/locale
RUN echo pt_BR.UTF-8 UTF-8 >> /etc/locale.gen && locale-gen

ENV LANG=C.UTF-8 
ENV LC_ALL "pt_BR.UTF-8"

ENV DISPLAY=:100

USER user
WORKDIR /home/user

EXPOSE 9876

CMD xpra start --bind-tcp=0.0.0.0:9876 --html=on --start-child=gnome-terminal --exit-with-children=no --daemon=no --xvfb="/usr/bin/Xvfb +extension Composite -screen 0 1360x768x24+32 -nolisten tcp -noreset" --pulseaudio=no --notifications=no --bell=no :100
