FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt update && \
    apt install -y xpra wget curl grep sed dpkg \
    xvfb \
    xterm \
    sshfs && \
    apt clean && \ 
    rm -rf /var/lib/apt/lists/*
   
RUN adduser --disabled-password --gecos "user" --uid 1000 user
RUN apt update && apt install -y sudo
RUN usermod -aG sudo user
RUN echo 'ALL ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
RUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

RUN apt update && \
    DEBIAN_FRONTEND=noninteractive && \
    apt clean && \ 
    rm -rf /var/lib/apt/lists/*

RUN apt update && apt install -y apt-utils \
    build-essential \
    libreoffice \
    htop \
    epiphany-browser \
    glances \
    glmark2 \
    mate-terminal \
    terminator \
	btop \
    libqt5x11extras5 \
    software-properties-common \
    tasksel && \
    apt clean && \ 
    rm -rf /var/lib/apt/lists/*

# DESKTOP ENVIRONMENT!
RUN apt update && apt install -y \
    mate-common \
    mate-desktop \
    lightdm && \
    apt clean && \ 
    rm -rf /var/lib/apt/lists/*

RUN mkdir -p /run/user/1000/xpra
RUN mkdir -p /run/xpra

RUN chown user:user /run/user/1000/xpra
RUN chown user:user /run/xpra

ENV DISPLAY=":100"
ENV PORTS="9876"
ENV CHILD="mate-terminal"
ENV passw0rd="P4ss0rd"

USER user
WORKDIR /home/user

CMD xpra start --bind-tcp=0.0.0.0:$PORTS,auth=file:filename=/home/user/.passwordfile --html=on --start-child=$CHILD --exit-with-children=no --daemon=no --xvfb="/usr/bin/Xvfb +extension Composite -screen 0 1360x768x24+32 -nolisten tcp -noreset" --pulseaudio=no --notifications=no --bell=no $DISPLAY
