#!/bin/bash

NOMECONTAINER="docker-osx"
docker_repo="sickcodes/docker-osx:latest"
imagem="docker-osx macos"

# Campos customizados para Docker-OSX
CustmN2="vnc_port"
CustmN3="ssh_port"
CustmN4="shortname"
CustmN5="ram_gb"
CustmN6="cpu_cores"
CustmN7="disk_size"
CustmN8="extra_params"
CustmN9=""
CustmN10=""

# Valores padrão
VALUE2="5901"
VALUE3="50922"
VALUE4="sonoma high-sierra mojave catalina big-sur monterey ventura sonoma"
VALUE5="8"
VALUE6="6"
VALUE7="256G"
VALUE8="-display none -vnc 0.0.0.0:1"
VALUE9=""
VALUE10=""

export NOMECONTAINER docker_repo imagem
export CustmN2 CustmN3 CustmN4 CustmN5 CustmN6 CustmN7 CustmN8 CustmN9 CustmN10
export VALUE2 VALUE3 VALUE4 VALUE5 VALUE6 VALUE7 VALUE8 VALUE9 VALUE10

if [ -f /tmp/common-functions.sh ]; then
  source /tmp/common-functions.sh
else
  echo "ERRO: common-functions.sh não encontrado!"
  exit 1
fi

function set_mkdir {
  sudo mkdir -p /srv/containers/"$NOMECONTAINER"/OSX-KVM
  sudo chmod -R 777 /srv/containers/"$NOMECONTAINER"
:; }

function docker_create {
  docker run -d --name="$NOMECONTAINER" --hostname="$NOMECONTAINER" \
  --device /dev/kvm \
  --network host \
  --no-healthcheck --restart=unless-stopped \
  -v /etc/localtime:/etc/localtime:ro \
  -p "$VALUE2:5901" \
  -p "$VALUE3:10022" \
  -e SHORTNAME="$VALUE4" \
  -e RAM="$VALUE5" \
  -e CORES="$VALUE6" \
  -e SIZE="$VALUE7" \
  -e EXTRA="$VALUE8" \
  -v "/srv/containers/$NOMECONTAINER/OSX-KVM:/home/arch/OSX-KVM" \
  "$docker_repo"
}

function docker_extras {
  echo ""
  echo "════════════════════════════════════════════════════════"
  echo "  Docker-OSX criado com sucesso!"
  echo "════════════════════════════════════════════════════════"
  echo ""
  echo "  📦 Container: $NOMECONTAINER"
  echo "  🖥️  macOS: $VALUE4"
  echo "  💾 RAM: ${VALUE5}GB"
  echo "  ⚙️  CPU: $VALUE6 cores"
  echo "  💿 Disco: $VALUE7"
  echo ""
  echo "  🔌 Portas:"
  echo "     VNC:  localhost:$VALUE2"
  echo "     SSH:  localhost:$VALUE3"
  echo ""
  echo "  🎯 Conectar via VNC (Remmina):"
  echo "     localhost:$VALUE2"
  echo ""
  echo "  📁 Volumes:"
  echo "     /srv/containers/$NOMECONTAINER/OSX-KVM"
  echo ""
  echo "════════════════════════════════════════════════════════"
  echo ""
:; }

execute_main
exit 0
