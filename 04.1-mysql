#!/bin/bash

# IP FIXO DO NOVO CONTAINER
LOCALIP="$1"
# USUARIO DO HOST
USERNAME="$2"
# NOVA SENHA DO ROOT MYSQL
MROOT="$3"

mkdir -p /home/"$USERNAME"/.CONTAINERS/

# INICIANDO MYSQL DATABASE
[ -d "/home/"$USERNAME"/.CONTAINERS/mysql" ] && {
  echo "Banco de Dados j√° existente encontrado!"
} || {
  docker run -d \
  --name mysql \
  --ip=$LOCALIP \
  --network macvlan \
  --hostname=mysql \
  --restart=unless-stopped \
  -p 80:80 \
  -v /etc/localtime:/etc/localtime:ro \
  -v /home/"$USERNAME"/.CONTAINERS/mysql:/var/lib/mysql \
  -e MYSQL_ROOT_PASSWORD="$MROOT" \
  mysql:8

docker network connect bridge mysql
}

# Execute manualmente:

# docker exec -it mysql mysql -p
# CREATE DATABASE nextcloud;
# CREATE USER nextcloud IDENTIFIED BY 'P4ssw0rd';
# GRANT ALL PRIVILEGES ON nextcloud.* TO nextcloud;
# FLUSH PRIVILEGES;
# exit
